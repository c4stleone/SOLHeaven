<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OutcomeEscrow Operator</title>
    <link rel="stylesheet" href="/style.css" />
  </head>
  <body>
    <main class="shell">
      <section class="panel top-nav">
        <a href="/">Home</a>
        <a href="/buyer.html">Buyer</a>
        <a class="active" href="/operator.html">Operator</a>
        <a href="/ops.html">Ops</a>
      </section>

      <section class="hero panel operator-hero">
        <p class="tag">Operator Workspace</p>
        <h1>MCP 판매자 작업 센터</h1>
        <p class="subtitle">
          어떤 요청이 들어왔는지 확인하고, 성공 기준 검토 후 승인/거절 및 결과 제출까지 연결합니다.
        </p>
        <div class="hero-actions">
          <button id="btn-refresh" class="btn btn-ghost" data-busy-lock>Refresh</button>
        </div>
      </section>

      <section class="kpi-grid operator-kpi-grid">
        <article class="panel kpi-card">
          <p class="kpi-label">요청 총합</p>
          <p id="metric-total" class="kpi-value">0</p>
        </article>
        <article class="panel kpi-card">
          <p class="kpi-label">검토 대기</p>
          <p id="metric-pending" class="kpi-value">0</p>
        </article>
        <article class="panel kpi-card">
          <p class="kpi-label">수락됨</p>
          <p id="metric-approved" class="kpi-value">0</p>
        </article>
        <article class="panel kpi-card">
          <p class="kpi-label">결과 제출 완료</p>
          <p id="metric-submitted" class="kpi-value">0</p>
        </article>
      </section>

      <section class="panel mcp-connect-panel">
        <div class="marketplace-head">
          <div>
            <h2>MCP 서버 연결</h2>
            <p class="hint">실제 MCP 서버 URL을 등록하고 연결 상태를 테스트할 수 있습니다.</p>
          </div>
          <span id="mcp-status-chip" class="status-chip tone-muted">Not connected</span>
        </div>
        <form id="form-mcp-connection" class="stack">
          <div class="grid two dense">
            <label
              >연결 이름
              <input id="mcp-name" type="text" placeholder="default-mcp-server" />
            </label>
            <label
              >MCP Server URL
              <input id="mcp-server-url" type="url" placeholder="https://mcp.example.com" />
            </label>
          </div>
          <div class="grid two dense">
            <label
              >Health Path
              <input id="mcp-health-path" type="text" value="/health" />
            </label>
            <label
              >가격 (USDC base units, 1e-6)
              <input id="mcp-price-lamports" type="number" min="1" step="1" value="1000000" />
            </label>
          </div>
          <label
              >Auth Token (optional)
              <input id="mcp-auth-token" type="password" placeholder="Bearer token or raw token" />
          </label>
          <div class="actions-row">
            <button id="btn-mcp-save" class="btn btn-secondary" type="button" data-busy-lock>
              설정 저장
            </button>
            <button id="btn-mcp-test" class="btn btn-primary" type="button" data-busy-lock>
              연결 테스트
            </button>
            <label class="inline-check">
              <input id="mcp-test-persist" type="checkbox" checked />
              테스트 결과를 설정에 반영
            </label>
          </div>
          <pre id="mcp-status-view" class="code compact"></pre>
        </form>
      </section>

      <section class="grid two operator-main-grid">
        <article class="panel">
          <div class="actions-row section-head">
            <h2>요청 인박스</h2>
            <select id="request-filter" data-busy-lock>
              <option value="">all</option>
              <option value="pending">pending</option>
              <option value="approved">approved</option>
              <option value="rejected">rejected</option>
            </select>
          </div>
          <p class="hint">Buyer가 등록한 MCP 요청과 성공 기준이 표시됩니다.</p>
          <div id="request-list" class="job-list"></div>
        </article>

        <article class="panel">
          <div class="job-summary-head">
            <h2>요청 상세</h2>
            <span id="request-status-chip" class="status-chip tone-muted">No request</span>
          </div>

          <dl class="summary-grid">
            <div>
              <dt>Job ID</dt>
              <dd id="detail-job-id">-</dd>
            </div>
            <div>
              <dt>Buyer</dt>
              <dd id="detail-buyer">-</dd>
            </div>
            <div>
              <dt>MCP 서비스</dt>
              <dd id="detail-service">-</dd>
            </div>
            <div>
              <dt>요청 상태</dt>
              <dd id="detail-request-status">-</dd>
            </div>
          </dl>

          <h3>요청사항</h3>
          <pre id="detail-brief" class="code compact"></pre>

          <h3>성공 기준</h3>
          <pre id="detail-criteria" class="code compact"></pre>

          <div class="actions-row">
            <button id="btn-request-approve" class="btn btn-primary" data-busy-lock>
              요청 수락
            </button>
            <button id="btn-request-reject" class="btn btn-secondary" data-busy-lock>
              요청 거절
            </button>
          </div>

          <label
            >판정 메모
            <input id="decision-reason" type="text" placeholder="거절/수락 사유 (선택)" />
          </label>

          <hr class="divider" />

          <h3>결과 제출</h3>
          <form id="form-submit" class="stack">
            <label
              >Buyer Public Key
              <input id="operator-buyer" type="text" placeholder="buyer pubkey" />
            </label>
            <label
              >Job ID
              <input id="operator-job-id" type="text" placeholder="job id 숫자" />
            </label>
            <label
              >Submission Payload
              <textarea id="operator-submission" rows="5">operator outcome payload</textarea>
            </label>
            <button class="btn btn-secondary" type="submit" data-busy-lock>Submit Result</button>
          </form>
        </article>
      </section>

      <section class="grid two operator-foot-grid">
        <article class="panel">
          <h2>MCP 상품 등록/수정</h2>
          <form id="form-catalog" class="stack">
            <label
              >서비스 ID (영문 슬러그, 선택)
              <input id="catalog-id" type="text" placeholder="weekly-stock-research-mcp" />
            </label>
            <label
              >서비스명
              <input id="catalog-title" type="text" placeholder="주간 주식시장 동향 리서치 MCP" />
            </label>
            <label
              >요약
              <textarea id="catalog-summary" rows="3" placeholder="서비스 설명"></textarea>
            </label>
            <div class="grid two dense">
              <label
                >카테고리
                <input id="catalog-category" type="text" value="research" />
              </label>
              <label
                >기본 산출 포맷
                <select id="catalog-output-format">
                  <option>PDF</option>
                  <option>Notion</option>
                  <option>Google Docs</option>
                </select>
              </label>
            </div>
            <label
              >Agent 가격 (USDC base units, 1e-6)
              <input id="catalog-agent-price-lamports" type="number" min="1" step="1" value="1000000" />
            </label>
            <button class="btn btn-secondary" type="submit" data-busy-lock>상품 저장</button>
          </form>
          <h3>등록된 상품</h3>
          <div id="catalog-list" class="job-list"></div>
        </article>

        <article class="panel">
          <h2>System / Activity</h2>
          <details class="raw-panel" open>
            <summary>Wallet / Config</summary>
            <pre id="wallets-view" class="code compact"></pre>
            <pre id="config-view" class="code compact"></pre>
          </details>
          <details class="raw-panel">
            <summary>Selected Job Snapshot</summary>
            <pre id="job-view" class="code compact"></pre>
          </details>
          <details class="raw-panel" open>
            <summary>Activity Log</summary>
            <pre id="log-view" class="code compact"></pre>
          </details>
        </article>
      </section>
    </main>

    <script src="/operator.js"></script>
  </body>
</html>
